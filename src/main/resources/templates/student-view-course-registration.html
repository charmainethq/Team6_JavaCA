<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Course Registration</title>

    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/student-enrollment-tables.css}"/>

    <style>
        /* left align override for name and description */
        table th:nth-child(2),
        table th:nth-child(3),
        table td:nth-child(2),
        table td:nth-child(3) {
            text-align: left;
        }


    </style>
</head>
<body>
<header>
    <div th:include="index.html"></div>
    <div th:include="index.html"></div>
</header>

<div class="container">
    <h1>Course Registration</h1>

    <div class="mb-3">
        <label for="searchInput">Search:</label>
        <input type="text"
               class="form-control"
               id="searchInput"
               placeholder="Search by Course Number, Name or Description"
               oninput="filterTable()">
    </div>
    <div class="mb-3">
        <label for="filterSelect">Filter by Eligibility:</label>
        <select class="form-control" id="filterSelect" onchange="filterTable()">
            <option value="all">All Courses</option>
            <option value="yes">Eligible to Register</option>
            <option value="no">Not Eligible to Register</option>
        </select>
    </div>
    <br>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Course Number</th>
            <th>Course Name</th>
            <th>Description</th>
            <th>Credits</th>
            <th>Duration</th>
            <th>Eligible to Register</th>
            <th>View Available Classes</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="course : ${courses}" id="courseRow">
            <td th:text="${course.courseNum}"></td>
            <td th:text="${course.name}"></td>
            <td th:text="${course.description}"></td>
            <td th:text="${course.credits}"></td>
            <td th:text="${course.duration}"></td>
            <td th:text="${canRegister[course.courseId] ? 'Yes' : 'No'}"></td>
            <td>
                <form th:if="${canRegister[course.courseId]}" th:action="@{'/student/viewClasses/' + ${course.courseId}}" method="get">
                    <button type="submit" class="btn btn-primary">View Classes</button>
                </form>
            </td>
        </tr>

        </tbody>
    </table>
</div>

<script th:src="@{/js/bootstrap.min.js}"></script>
<script>
    function filterTable() {
        const searchInput = document.querySelector('#searchInput').value.toLowerCase();
        const filterSelect = document.querySelector('#filterSelect').value;
        const courseRows = document.querySelectorAll('tbody tr');

        courseRows.forEach(function (row) {
            const courseNum = row.cells[0].textContent.toLowerCase();
            const name = row.cells[1].textContent.toLowerCase();
            const description = row.cells[2].textContent.toLowerCase();
            const eligibility = row.cells[5].textContent.toLowerCase();

            const matchesSearchInput =
                courseNum.includes(searchInput) ||
                name.includes(searchInput) ||
                description.includes(searchInput);

            const matchesEligibility =
                filterSelect === 'all' ||
                (filterSelect === 'yes' && eligibility === 'yes') ||
                (filterSelect === 'no' && eligibility === 'no');

            if (matchesSearchInput && matchesEligibility) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

</script>
</body>
</html>