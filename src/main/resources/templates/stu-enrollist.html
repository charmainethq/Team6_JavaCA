<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Enrollment List</title>
    <link rel="stylesheet" href="/css/detail.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <style>
        #calendar {
            padding: 60px;
        }
    </style>
</head>

<body>
<header>
    <div th:include="studentPage.html"></div>
</header>
<table class="table table-striped">
    <thead>
    <tr>
        <th>Courses</th>
        <th>StartTime - EndTime</th>
        <th>ClassRoom</th>
        <th>EnrollmentStatus</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="enrol : ${enrollments}">
        <td th:text="${enrol.CourseClass.Course.name}"></td>
        <td th:text="${enrol.CourseClass.startDate + ' - ' + enrol.CourseClass.getFormatEndDate()}"></td>
        <td th:text="${enrol.CourseClass.roomNum}"></td>
        <td th:text="${enrol.enrollmentStatus}"></td>
    </tr>
    </tbody>
</table>

<div id="calendar"></div>

<script>
        document.addEventListener('DOMContentLoaded', function() {
        // Retrieve the enrollment data from the table
        const enrollmentData = [];
        const enrollmentRows = document.querySelectorAll("tbody tr");
        enrollmentRows.forEach(function(row) {
            const courseName = row.cells[0].textContent.trim();
            const dateRange = row.cells[1].textContent.trim();
            const roomNum = row.cells[2].textContent.trim();
            const enrollmentStatus = row.cells[3].textContent.trim();

            // Filter events based on enrollment status
            if (enrollmentStatus === "CONFIRMED") {
                // Parse the start and end dates from the date range
                const [startDate, endDate] = dateRange.split(" - ");

                const event = {
                    title: courseName,
                    start: startDate,
                    end: endDate,
                    description: `Room: ${roomNum}\nEnrollment Status: ${enrollmentStatus}`,
                };

                // Add the event to the enrollment data array
                enrollmentData.push(event);
            }
        });

        // initialize fullcalendar
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          headerToolbar: {
              left: 'prev,next today',
              center: 'title',
              right: 'dayGridMonth,timeGridWeek'
            },
          events: enrollmentData,
          eventDidMount: function(info) {
                // Display the event description directly on the calendar
                const descriptionElement = document.createElement('div');
                descriptionElement.classList.add('event-description');
                descriptionElement.innerHTML = info.event.extendedProps.description;
                info.el.appendChild(descriptionElement);
            }
        });
        calendar.render();
      });
    </script>
</body>
</html>
